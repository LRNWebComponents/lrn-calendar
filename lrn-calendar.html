<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../materializecss-styles/colors.html">
<link rel="import" href="../paper-card/paper-card.html">
<link rel="import" href="../hax-body-behaviors/hax-body-behaviors.html">
<link rel="import" href="../iron-ajax/iron-ajax.html">
<link rel="import" href="lrn-calendar-date.html">
<script src="main.js"></script>
<script src="ical.js"></script>
<!--
`lrn-calendar`
A LRN element

@demo demo/index.html
-->

<dom-module id="lrn-calendar">
  <template>
    <style>
      :host {
        display: block;
      }
      lrn-calendar-date {
        display: inline-table;
        top: 0px;
      }
      paper-card {
        width: 14%;
        height: 20px;
        display: inline-table;
        padding: 0;
        margin: 0;
      }
    </style>

    <div class="calendar">
      <paper-icon-button icon="arrow-back" on-click="showPrev"></paper-icon-button>
      <paper-icon-button icon="arrow-forward" on-click="showNext"></paper-icon-button>
      <div class="testing" id="test">
      <h2>[[date]]</h2>
      </div>
      <!--<form method="post" action="#" onsubmit="return validate()">
      <h1>iCalendar / jCal Validator</h1>
      <p id="descr">This validator form takes either iCalendar or jCal data. iCalendar data will be parsed to jCal and re-serialized to iCalendar. Similarly, jCal data will be parsed to iCalendar and re-serialized to jCal.</p>
      <textarea id="data" rows="20" cols="80"></textarea><br/>
      <input type="submit" value="Validate" /><br/>
      <p id="duration"></p>
      <hr>
      <pre id="error"></pre>
      <div id="jcalbox" style="display: none">
        <h2>jCal Representation</h2>
        <pre id="jcal"></pre>
        <hr>
      </div>
      <div id="icalbox" style="display: none">
        <h2>iCalendar Representation</h2>
        <pre id="ical"></pre>
      </div>
    </form> -->
    </div>
  </template>
  <script>
    Polymer({
      is: 'lrn-calendar',
      behaviors: [
        HAXBehaviors.PropertiesBehaviors,
      ],
      properties: {
        /**
         * Date to start from
         */
        date:{
          type: Date,
          value: '2018/2/8',
        },
        /**
         * Number of weeks to display
         */
        numweeks: {
          type: Number,
          value: 1
        },
        /**
         * Only show week days, no weekends.
         */
        weekdaysonly: {
          type: Boolean,
          value: false,
        },
        /**
         * Type of display, possible values, month, day, week
         */
        view:{
          type: String,
          value: "month",
        },
        /**
         * ical file to reference to pull in dates.
         */
        file:{
          type: String,
          value: 'sampleCal.ics',
        },
      },
      /**
       * Ready lifecycle.
       */
      ready: function() {
        this.createCalendar();
      },
      /**
       * Attached lifecycle.
       */
      attached: function() {
        // Establish hax properties if they exist
        let props = {
          'canScale': false,
          'canPosition': false,
          'canEditSource': false,
          'gizmo': {
            'title': 'Calendar',
            'description': 'Present dates.',
            'icon': 'icons:today',
            'color': 'grey',
            'groups': ['Date'],
            'handles': [
              {
                'type': 'ical',
                'source': 'file',
                'date': 'date'
              }
            ],
            'meta': {
              'author': 'LRNWebComponents'
            }
          },
          'settings': {
            'quick': [
              {
                'property': 'file',
                'title': 'iCal feed',
                'description': 'Calendar feed to display',
                'inputMethod': 'textfield',
                'icon': 'link',
                'required': true,
                'validationType': 'url',
              },
              {
                'property': 'weekdaysonly',
                'title': 'Weekdays only',
                'description': 'only show weekdays',
                'inputMethod': 'boolean',
                'icon': 'icons:date-range',
              },
            ],
            'configure': [
              {
                'property': 'file',
                'title': 'iCal feed',
                'description': 'Calendar feed to display',
                'inputMethod': 'textfield',
                'icon': 'link',
                'required': true,
                'validationType': 'url',
              },
              {
                'property': 'weekdaysonly',
                'title': 'Weekdays only',
                'description': 'only show weekdays',
                'inputMethod': 'boolean',
                'icon': 'icons:date-range',
              },
              {
                'property': 'view',
                'title': 'Number of weeks to display',
                'description': 'Weeks to display at a time',
                'inputMethod': 'select',
                'options': {
                  'day': 'Day',
                  'week': 'Week',
                  'month': 'Month',
                },
              },
              {
                'property': 'numweeks',
                'title': 'Number of weeks to display',
                'description': 'Weeks to display at a time',
                'inputMethod': 'textfield',
              },
            ],
            'advanced': []
          }
        };
        this.setHaxProperties(props);
        this._initializeReader();
      },
      _initializeReader: function() {
        this.instance = new Polymer.Reader(this);
        this.instance.startMonth = this.date.getMonth() + 1;
        this.instance.startYear = this.date.getFullYear();
        this.instance.startDay = this.date.getDate();
        this.instance.startDayOfWeek = this.date.getDay();
        this.instance.currentDate = this.startDay;
        this.instance.currentMonth = this.startMonth;
        this.instance.currentYear = this.startYear;
        this.instance.currentDayofWeek = this.startDayOfWeek;
        this.instance.totalDays = (this.numweeks * 7);
        this.instance.view = this.view;
        this.instance.calendarText = this.instance.readTextFile(this.file);
        this.instance.createCalendar();
      },
      /*
      * Is called to show the previous month
      */
      showPrev: function() {
        if(this.view == "month"){
          if (this.date.getMonth() == 0) {
              var current = new Date(this.date.getFullYear() - 1, 11, this.date.getDate());
          } else {
              var current = new Date(this.date.getFullYear(), this.date.getMonth() - 1, this.date.getDate());
          }
          this.date = current;
        }
        else{

        }
        this.instance.startMonth = this.date.getMonth() + 1;
        this.instance.startYear = this.date.getFullYear();
        this.instance.startDay = this.date.getDate();
        this.instance.startDayOfWeek = this.date.getDay();
        this.instance.currentDate = this.instance.startDay;
        this.instance.currentMonth = this.instance.startMonth;
        this.instance.currentYear = this.instance.startYear;
        this.instance.currentDayofWeek = this.instance.startDayOfWeek;
        this.instance.totalDays = (this.numweeks * 7);
        this.instance.view = this.view;
        console.log("CREATE CALENDAR AGAIN");
        this.instance.queueRenderPage();
      },
      /*
      * Is called to show the next month/week
      */
      showNext: function() {
        if(this.view == "month"){
          if (this.date.getMonth() == 11) {
              var current = new Date(this.date.getFullYear() + 1, 0, this.date.getDate());
          } else {
              var current = new Date(this.date.getFullYear(), this.date.getMonth() + 1, this.date.getDate());
          }
          this.date = current;
        }

        this.instance.startMonth = this.date.getMonth() + 1;
        this.instance.startYear = this.date.getFullYear();
        this.instance.startDay = this.date.getDate();
        this.instance.startDayOfWeek = this.date.getDay();
        this.instance.currentDate = this.instance.startDay;
        this.instance.currentMonth = this.instance.startMonth;
        this.instance.currentYear = this.instance.startYear;
        this.instance.currentDayofWeek = this.instance.startDayOfWeek;
        this.instance.totalDays = (this.numweeks * 7);
        this.instance.view = this.view;
        console.log("CREATE CALENDAR AGAIN");
        this.instance.queueRenderPage();
      },

      createCalendar: function() {
        this.startMonth = this.date.getMonth() + 1;
        this.startYear = this.date.getFullYear();
        this.startDay = this.date.getDate();
        this.startDayOfWeek = this.date.getDay();
        this.currentDate = this.startDay;
        this.currentMonth = this.startMonth;
        this.currentYear = this.startYear;
        this.currentDayofWeek = this.startDayOfWeek;
        this.totalDays = (this.numweeks * 7);
        var days = 1;
        var pastDate = 0;
      },
    });
  </script>
</dom-module>
